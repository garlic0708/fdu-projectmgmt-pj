<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        input{
            display: block;
            border:1px solid #090;
            width: 200px;
            height: 40px;
            line-height: 40px;
            font-size: 16px;
            margin: 50px auto;
            text-indent: 2em;
        }
        #div1{
            margin-left: 43%;
        }
        button{
            margin-left: 50%;
            width:50px;
            height:30px;
        }
        #div2{
            margin-left: 30%;
        }
    </style>
</head>
<body>
<input type="text" id='btn' disable='disable' value="">
<button type="button" onclick="search()">搜索</button>
<div id="div1">

</div>

<div id="div2">

</div>
<script>
    var oBtn = document.getElementById('btn');
    var arr = [];
    var location1=[];
    // var ie = !!window.ActiveXObject;
    //    if(ie){
    //        oBtn.onpropertychange = getWord;
    //    }else{
    //        oBtn.addEventListener("input",getWord,false);
    //    }
    function search(){
        //console.log(oBtn.value);
        var a =oBtn.value;
        console.log(1);
        console.log(a);
        xmlHttp = createXMLHttpRequest();
        var url = "https://restapi.amap.com/v3/assistant/inputtips?output=xml&keywords="+a+"&key=93c4bd0fee3dd51c49b2f93b64749208&location=122.1137989,31.66889673";
        xmlHttp.open("GET", url, true);// 异步处理返回
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState == 4) {
                var responseText = xmlHttp.responseText;
                //console.log(responseText);
                var parser=new DOMParser();
                var xmlDoc=parser.parseFromString(responseText,"text/xml");
                var countrys = xmlDoc.getElementsByTagName('name');
                console.log(countrys.length);
                var loca=xmlDoc.getElementsByTagName('location');
                arr=[];
                location1=[];
                for (var i = 0; i < countrys.length; i++) {
                    arr.push(countrys[i].innerHTML);
                };
                console.log(arr);

                for(var i=0;i<loca.length;i++){
                    location1.push(loca[i].innerHTML);
                }
                console.log(location1);
                var div1=document.getElementById("div1");
                var tab="<div border='1' bordercolor='blue' width='200' height='10'>";
                //循环行
                var num=0;
                for(var i=0;i<arr.length;i++)
                {
                    tab+="<div>";
                    //循环列
                    for(var j=1;j<=1;j++)
                    {
                        tab+="<a href='#' onclick='drawLocation("+i+")'>"+arr[i]+"</a>";
                    }
                    tab+="</div>";
                }
                tab+="</table>"
                div1.innerHTML=tab;
            }
        }
        xmlHttp.setRequestHeader("Content-Type",
            "application/x-www-form-urlencoded;");
        xmlHttp.send();
    }

    function drawLocation(i){
        var div2=document.getElementById("div2");
        div2.removeChild(div2.lastChild);
        xmlHttp = createXMLHttpRequest();
        var url ="https://restapi.amap.com/v3/staticmap?location="+location1[i]+"&zoom=15&size=750*300&markers=mid,,A:"+location1[i]+"&key=93c4bd0fee3dd51c49b2f93b64749208";
        xmlHttp.open("GET", url, true);// 异步处理返回
        xmlHttp.responseType = "blob";
        xmlHttp.onload = function() {
            if (this.status == 200) {
                console.log(1);
                var blob = this.response;
                console.log(blob);
                var img = document.createElement("img");
                img.onload = function(e) {
                    window.URL.revokeObjectURL(img.src); // 清除释放
                };
                img.src = window.URL.createObjectURL(blob);
                div2.appendChild(img);
            }
        }
        xmlHttp.send();
    }

    function createXMLHttpRequest() {
        var xmlHttp;
        if (window.XMLHttpRequest) {
            xmlHttp = new XMLHttpRequest();
            if (xmlHttp.overrideMimeType)
                xmlHttp.overrideMimeType('text/xml');
        } else if (window.ActiveXObject) {
            try {
                xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
            } catch (e) {
                try {
                    xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                } catch (e) {
                }
            }
        }
        return xmlHttp;
    }

</script>
</body>
</html>